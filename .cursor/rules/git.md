# Git Safety Rules

このルールは AI が Git 操作を安全に実行するための行動規則である。
危険な操作は禁止するだけでなく、安全な代替行動を必ず選択する。

---

## 基本原則

* 履歴を壊さない
* 他人の作業を上書きしない
* 不明な状態では push しない
* 自動処理は常に保守的に動作する

---

## push ルール

### main / master
直接 push を禁止する。

代替行動:
新規ブランチを作成してから push する

形式:
feature/<scope>-YYYYMMDDHHMM

---

### force push
常に禁止

例外:
ユーザーが明示的に許可した場合のみ

---

### 大量変更

変更ファイル数 >= 10 の場合:
- 変更内容を要約して表示
- ユーザー確認を求める
- auto モードでも確認をスキップしない

変更ファイル数 >= 50 の場合:
- push を中断
- dry-run を提案

---

## PR ルール

* 自動PRはデフォルトで Draft
* 同一ブランチの既存PRがある場合は新規作成しない
* PR更新を優先する

---

## 競合検出

push 前に upstream を取得する:
git fetch

差分が存在する場合:
- rebase を試行
- 失敗したら自動解決しない
- ユーザーへ通知して停止

---

## 履歴保護

以下を禁止:
* rebase 後の自動 push
* squash の自動実行
* merge commit の自動生成

---

## secrets 検出

以下を含む場合は push を中断:

- .env
- private key
- credential
- token
- password

差分を表示しユーザーへ警告する

---

## 既存変更の扱い

未ステージ変更がある場合:
- 自動で add しない
- ユーザーへ確認を求める

---

## エラー時の挙動

push 失敗時:
- 1回のみ再試行
- 失敗理由を表示
- 自動修復を行わない
